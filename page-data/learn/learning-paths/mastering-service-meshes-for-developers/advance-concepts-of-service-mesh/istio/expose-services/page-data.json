{"componentChunkName":"component---src-templates-learn-chapter-js","path":"/learn/learning-paths/mastering-service-meshes-for-developers/advance-concepts-of-service-mesh/istio/expose-services/","result":{"data":{"chapter":{"body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"docType\": \"Chapter\",\n  \"chapterTitle\": \"Exposing services through Istio Ingress Gateway\",\n  \"description\": \"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads.\",\n  \"videos\": 4,\n  \"lectures\": 12,\n  \"order\": 3\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(ChapterStyle, {\n    mdxType: \"ChapterStyle\"\n  }, \"The components deployed on the service mesh by default are not exposed outside the cluster. An Ingress Gateway is deployed as a Kubernetes service of type LoadBalancer (or NodePort). To make Bookinfo accessible external to the cluster, you have to create an `Istio Gateway` for the Bookinfo application and also define an `Istio VirtualService` with the routes we need.\", mdx(\"br\", null), mdx(\"br\", null), mdx(\"h2\", {\n    className: \"chapter-sub-heading\"\n  }, \" Inspecting the Istio Ingress Gateway\"), mdx(\"br\", null), \"The ingress gateway gets exposed as a normal Kubernetes service of type LoadBalancer (or NodePort):\", mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl get svc istio-ingressgateway -n istio-system -o yaml\\n\")), mdx(\"p\", null, \"Because the Istio Ingress Gateway is an Envoy Proxy you can inspect it using the admin routes. First find the name of the istio-ingressgateway:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl get pods -n istio-system\\n\")), mdx(\"p\", null, \"Copy and paste your ingress gateway's pod name. Execute:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl -n istio-system exec -it <istio-ingressgateway-...> bash\\n\")), mdx(\"p\", null, \"You can view the statistics, listeners, routes, clusters and server info for the Envoy proxy by forwarding the local port:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"curl localhost:15000/help\\ncurl localhost:15000/stats\\ncurl localhost:15000/listeners\\ncurl localhost:15000/clusters\\ncurl localhost:15000/server_info\\n\")), mdx(\"p\", null, \"See the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.envoyproxy.io/docs/envoy/latest/operations/admin\"\n  }, \"admin docs\"), \" for more details.\"), mdx(\"p\", null, \"Also it can be helpful to look at the log files of the Istio ingress controller to see what request is being routed.\"), mdx(\"p\", null, \"Before we check the logs, let us get out of the container back on the host:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"exit\\n\")), mdx(\"p\", null, \"Now let us find the ingress pod and output the log:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl logs istio-ingressgateway-... -n istio-system\\n\")), mdx(\"h2\", {\n    className: \"chapter-sub-heading\"\n  }, \"View Istio Ingress Gateway for Bookinfo\"), mdx(\"br\", null), mdx(\"h3\", {\n    className: \"chapter-sub-heading\"\n  }, \" View the Gateway and VirtualServices\"), mdx(\"p\", null, \"Check the created \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Istio Gateway\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Istio VirtualService\"), \" to see the changes deployed:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl get gateway\\nkubectl get gateway -o yaml\\n\\nkubectl get virtualservices\\nkubectl get virtualservices -o yaml\\n\")), mdx(\"h3\", {\n    className: \"chapter-sub-heading\"\n  }, \"Find the external port of the Istio Ingress Gateway by running:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl get service istio-ingressgateway -n istio-system -o wide\\n\")), mdx(\"p\", null, \"To just get the first port of istio-ingressgateway service, we can run this:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl get service istio-ingressgateway -n istio-system --template='{{(index .spec.ports 1).nodePort}}'\\n\")), mdx(\"h3\", {\n    className: \"chapter-sub-heading\"\n  }, \" Create a DNS entry:\"), mdx(\"p\", null, \"Modify your local \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/etc/hosts\"), \" file to add an entry for your sample application.\"), mdx(\"p\", null, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"127.0.0.1. bookinfo.meshery.io\")), mdx(\"p\", null, \"The HTTP port is usually 31380.\"), mdx(\"p\", null, \"Or run these commands to retrieve the full URL:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"echo \\\"http://$(kubectl get nodes --selector=kubernetes.io/role!=master -o jsonpath={.items[0].status.addresses[?\\\\(@.type==\\\\\\\"InternalIP\\\\\\\"\\\\)].address}):$(kubectl get svc istio-ingressgateway -n istio-system -o jsonpath='{.spec.ports[1].nodePort}')/productpage\\\"\\n\")), mdx(\"p\", null, \"Docker Desktop users please use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"http://localhost/productpage\"), \" to access product page in your browser.\"), mdx(\"h2\", {\n    className: \"chapter-sub-heading\"\n  }, \" Apply default destination rules\"), mdx(\"p\", null, \"Before we start playing with Istio's traffic management capabilities we need to define the available versions of the deployed services. They are called subsets, in destination rules.\"), mdx(\"p\", null, \"Using Meshery, navigate to the Custom yaml page, and apply the below to create the subsets for BookInfo:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"apiVersion: networking.istio.io/v1alpha3\\nkind: DestinationRule\\nmetadata:\\n  name: productpage\\nspec:\\n  host: productpage\\n  subsets:\\n    - name: v1\\n      labels:\\n        version: v1\\n---\\napiVersion: networking.istio.io/v1alpha3\\nkind: DestinationRule\\nmetadata:\\n  name: reviews\\nspec:\\n  host: reviews\\n  subsets:\\n    - name: v1\\n      labels:\\n        version: v1\\n    - name: v2\\n      labels:\\n        version: v2\\n    - name: v3\\n      labels:\\n        version: v3\\n---\\napiVersion: networking.istio.io/v1alpha3\\nkind: DestinationRule\\nmetadata:\\n  name: ratings\\nspec:\\n  host: ratings\\n  subsets:\\n    - name: v1\\n      labels:\\n        version: v1\\n    - name: v2\\n      labels:\\n        version: v2\\n    - name: v2-mysql\\n      labels:\\n        version: v2-mysql\\n    - name: v2-mysql-vm\\n      labels:\\n        version: v2-mysql-vm\\n---\\napiVersion: networking.istio.io/v1alpha3\\nkind: DestinationRule\\nmetadata:\\n  name: details\\nspec:\\n  host: details\\n  subsets:\\n    - name: v1\\n      labels:\\n        version: v1\\n    - name: v2\\n      labels:\\n        version: v2\\n\")), mdx(\"p\", null, \"This creates destination rules for each of the BookInfo services and defines version subsets\"), mdx(\"p\", null, \"In a few seconds we should be able to verify the destination rules created by using the command below:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl get destinationrules\\n\\n\\nkubectl get destinationrules -o yaml\\n\")), mdx(\"h2\", {\n    className: \"chapter-sub-heading\"\n  }, \" Browse to BookInfo\"), mdx(\"p\", null, \"Browse to the website of the Bookinfo. To view the product page, you will have to append\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/productpage\"), \" to the url.\"), mdx(\"h3\", {\n    className: \"chapter-sub-heading\"\n  }, \" Reload Page\"), mdx(\"p\", null, \"Now, reload the page multiple times and notice how it round robins between v1, v2 and v3 of the reviews service.\"), mdx(\"h2\", {\n    className: \"chapter-sub-heading\"\n  }, \"Inspect the Istio proxy of the productpage pod\"), mdx(\"p\", null, \"To better understand the istio proxy, let's inspect the details. Let us \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"exec\"), \" into the productpage pod to find the proxy details. To do so we need to first find the full pod name and then \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"exec\"), \" into the istio-proxy container:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl get pods\\nkubectl exec -it productpage-v1-... -c istio-proxy  sh\\n\")), mdx(\"p\", null, \"Once in the container look at some of the envoy proxy details by inspecting it's config file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"ps aux\\nls -l /etc/istio/proxy\\ncat /etc/istio/proxy/envoy-rev0.json\\n\")), mdx(\"p\", null, \"For more details on envoy proxy please check out their \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.envoyproxy.io/docs/envoy/v1.5.0/operations/admin\"\n  }, \"admin docs\"), \".\"), mdx(\"p\", null, \"As a last step, lets exit the container:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"exit\\n\")), mdx(\"br\", null), mdx(\"h3\", null, \"Alternative: Manual installation\"), \"Follow this if the above steps did not work for you\", mdx(\"br\", null), mdx(\"br\", null), mdx(\"h4\", {\n    className: \"chapter-alt-heading\"\n  }, \" Default destination rules\"), mdx(\"p\", null, \"Run the following command to create default destination rules for the Bookinfo services:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl apply -f samples/bookinfo/networking/destination-rule-all-mtls.yaml\\n\")), mdx(\"h4\", {\n    className: \"chapter-alt-heading\"\n  }, \"Configure the Bookinfo route with the Istio Ingress gateway\"), mdx(\"p\", null, \"We can create a virtualservice & gateway for bookinfo app in the ingress gateway by running the following:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-sh\"\n  }, \"kubectl apply -f samples/bookinfo/networking/bookinfo-gateway.yaml\\n\"))));\n}\n;\nMDXContent.isMDXComponent = true;","frontmatter":{"chapterTitle":"Exposing services through Istio Ingress Gateway","description":"Meshery is the cloud native management plane which offers lifecycle, configuration, and performance management of service meshes and their workloads."},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/advance-concepts-of-service-mesh/istio/expose-services/","course":"advance-concepts-of-service-mesh","learnpath":"mastering-service-meshes-for-developers","chapter":"expose-services"}},"course":{"nodes":[{"frontmatter":{"courseTitle":"Advance Concepts of Service Meshes - Hands On","meshesYouLearn":[{"imagepath":{"childImageSharp":null,"extension":"svg","publicURL":"/static/731763d720780a49c2ffdfede8c28f4b/istio.svg"},"name":"Istio"},{"imagepath":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsTAAALEwEAmpwYAAAEX0lEQVQ4y2WTW1CVVRTHFx5BCNESDiJxk0tw9oLjYE5TY9NDPjRhNU15qQeHfKjJZnrImZrpwemhC9M0aEmiYdkgsPfhIk2KioKGCJOACBoqBKJy1bPXAZRrgGc36zufvfTwzXz72//fb62193wgtAJ+kP73fIykHiGpz6wMySAk9TmSMrwntLRyj3lrrSXwIghJOpCsQDiSSrKFiUiqzBZ0C5KtQkt+L7L3wMpqZpiVDnZB1oOjvHhcqQC1NELLQ0LLJ+wONghSrRiQ3UJScUgqDEkdEloZodWPgQml5YLM8VIhtMqxPy5DUl9YXWm1KEjuxsC4IEhtR1KjvCe0GkdSi0jqEyQZYjeTwy5w3Sv3IXFX6pTQKs0eZTWSKkdtjduPWr7y3zmR+hpJ+ZHUvNByu9DqGWbZwS5Ye73OpA9Wf4k+OSUCgkL7LAG1eh5JddrnWIekUu2CT6OWx+xuDfrkZPpg9VfsgsTOPx65RiuakOSi0AzLeaHVGGq1KwDz7alcJDlhi/cjqRD7Il4UWrUhScvBLnDdqzBI0ie0+gB9ZXwWSUjSa3fbiyRfDXTLFyfz7K5mkeQuSxpg3keSxC5Iu33cpN0+vjFjuIorvowk2+3bk0iyyXonVWkX4ky80Op4oKC8wUz68DFI7T+xkV2QePW8iW9vdLunj0S67lUsCK36keQmq7LXsxxJdtsFWJCfMVLp4D0k+ZLQqo8Z98yRyPjLF93sgtjmFhNz4fI61/2K6JTeU/6Uv0+/mT5UzcBOJDkktNJI8lMk+Y0tnUCSuemD1cBZZlz3y6NjGtrXsQuiartMZM1Nd2pfjTOho8GfcOXCVmMAMkaqSHg9LGgVWj3F42aOlSa47ns6MkYqZ+E5A5xlhtnImu4sdsHKqn4T4RlwJ3Y2ONc0tvljGi9vgXcNJHef8aXd+f0c+soG7ZG/S+k9BUnX63Yk99TOLy8ZBc4yk9DR4IzwDGSxC8J+9ZrQwz73moutzsiTN/yRJ29uCS3yQXx742Lsn5dyo+uv8i0eZGnmWOmd5J7as3FtTeOwzQBnmYlpbHOGHvZlsguCC6ZuLdk7tz7qzF9RK8rvLkR4Bt6GrQZWn78ynnjtXNML5tsY/kddo5WpmRMl9Sk9p010fecQgAHOMhNV2xW1ZO9cdnDBVB9AnlkJucYR9gutDf3Zx91u5/CTv/UNJXXVmcyJkinh9ez50CD/BFwof9WJ7hnYbYCzzDALO4zDcsEeA459sxBycCJk6f7po459czkQZyBCDUyuOtGdl/Ww+IJ1hl41tt5fuGl56fBHKzx3Z+Ed5uZymGGWHeyCJfn/BDn2zQU5vp+FZUU+4O6cZ6+FBx+YHF/T1DKd9bB4QXg9VcLrOZ31oNjENrcsBh+YHHPWXQ3nLDPMsoNdEFL4EJbun4GlP8xA2BFvEGw2AK8ZPor3YpsvdWTPF23bYArgWX8hZC/89FZsc8sVyDM74Q0D8LqxGGbZwa5/AV+tJbZA5UztAAAAAElFTkSuQmCC"},"images":{"fallback":{"src":"/static/be16a1eb5f902113368ddb9631638bec/59f98/linkerd.png","srcSet":"/static/be16a1eb5f902113368ddb9631638bec/d28d4/linkerd.png 13w,\n/static/be16a1eb5f902113368ddb9631638bec/933ac/linkerd.png 25w,\n/static/be16a1eb5f902113368ddb9631638bec/59f98/linkerd.png 50w,\n/static/be16a1eb5f902113368ddb9631638bec/fb990/linkerd.png 100w","sizes":"(min-width: 50px) 50px, 100vw"},"sources":[{"srcSet":"/static/be16a1eb5f902113368ddb9631638bec/02e18/linkerd.webp 13w,\n/static/be16a1eb5f902113368ddb9631638bec/04db5/linkerd.webp 25w,\n/static/be16a1eb5f902113368ddb9631638bec/2bba5/linkerd.webp 50w,\n/static/be16a1eb5f902113368ddb9631638bec/2d116/linkerd.webp 100w","type":"image/webp","sizes":"(min-width: 50px) 50px, 100vw"}]},"width":50,"height":47}},"extension":"png","publicURL":"/static/be16a1eb5f902113368ddb9631638bec/linkerd.png"},"name":"Linkerd"}]},"fields":{"slug":"learn/learning-paths/mastering-service-meshes-for-developers/advance-concepts-of-service-mesh/"}}]},"TOC":{"nodes":[{"frontmatter":{"order":8,"chapterTitle":"Conclusion"},"fields":{"section":"istio","chapter":"conclusion"}},{"frontmatter":{"order":2,"chapterTitle":"Deploy a sample application"},"fields":{"section":"istio","chapter":"deploy-an-application"}},{"frontmatter":{"order":1,"chapterTitle":"Getting Started"},"fields":{"section":"istio","chapter":"getting-started"}},{"frontmatter":{"order":3,"chapterTitle":"Exposing services through Istio Ingress Gateway"},"fields":{"section":"istio","chapter":"expose-services"}},{"frontmatter":{"order":4,"chapterTitle":"Observability"},"fields":{"section":"istio","chapter":"observability"}},{"frontmatter":{"order":6,"chapterTitle":"Service security capabilities"},"fields":{"section":"istio","chapter":"service-security-capabilities"}},{"frontmatter":{"order":5,"chapterTitle":"Traffic management"},"fields":{"section":"istio","chapter":"traffic-management"}},{"frontmatter":{"order":7,"chapterTitle":"WebAssembly and intelligent data planes"},"fields":{"section":"istio","chapter":"webassembly-and-intelligent-data-planes"}}]},"serviceMeshesList":{"nodes":[{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}},{"fields":{"section":"istio"}}]}},"pageContext":{"learnpath":"mastering-service-meshes-for-developers","slug":"learn/learning-paths/mastering-service-meshes-for-developers/advance-concepts-of-service-mesh/istio/expose-services/","course":"advance-concepts-of-service-mesh","section":"istio","chapter":"expose-services","pageType":"chapter"}},"staticQueryHashes":["2449327605","4047814605"]}