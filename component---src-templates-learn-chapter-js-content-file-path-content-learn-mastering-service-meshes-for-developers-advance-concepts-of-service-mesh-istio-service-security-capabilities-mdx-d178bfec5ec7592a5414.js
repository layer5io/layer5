"use strict";(self.webpackChunkLayer5=self.webpackChunkLayer5||[]).push([[50211],{34535:function(e,n,a){a.r(n),a.d(n,{Head:function(){return d},default:function(){return p}});a(20410);var t=a(28453),s=a(96540),i=a(94441);function l(e){const n=Object.assign({p:"p",pre:"pre",code:"code"},(0,t.R)(),e.components);return s.createElement(i.x,null,s.createElement("h2",{className:"chapter-sub-heading"},"Access Control"),s.createElement(n.p,null,"You will start by denying all traffic."),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},"apiVersion: security.istio.io/v1beta1\nkind: AuthorizationPolicy\nmetadata:\n  name: deny-all\n  namespace: default\nspec: {}\n")),s.createElement("h3",{className:"chapter-sub-heading"},s.createElement(n.p,null,'And then begin poking holes in your service mesh "firewall".')),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},'---\napiVersion: "security.istio.io/v1beta1"\nkind: "AuthorizationPolicy"\nmetadata:\n  name: "allow-get"\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: httpbin\n  rules:\n    - to:\n        - operation:\n            methods: ["GET"]\n')),s.createElement("h3",{className:"chapter-sub-heading"},s.createElement(n.p,null,"Create AuthorizationPolicy for each BookInfo service.")),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},'---\napiVersion: "security.istio.io/v1beta1"\nkind: "AuthorizationPolicy"\nmetadata:\n  name: "view-productpage"\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: productpage\n  rules:\n    - to:\n        - operation:\n            methods: ["GET", "POST"] # try login with just GET (fails)\n---\napiVersion: "security.istio.io/v1beta1"\nkind: "AuthorizationPolicy"\nmetadata:\n  name: "view-details"\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: details\n  rules:\n    - from:\n        - source:\n            principals: ["cluster.local/ns/default/sa/bookinfo-productpage"]\n      to:\n        - operation:\n            methods: ["GET", "POST"]\n---\napiVersion: "security.istio.io/v1beta1"\nkind: "AuthorizationPolicy"\nmetadata:\n  name: "view-reviews"\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: reviews\n  rules:\n    - from:\n        - source:\n            principals: ["cluster.local/ns/default/sa/bookinfo-productpage"]\n      to:\n        - operation:\n            methods: ["GET", "POST"]\n---\napiVersion: "security.istio.io/v1beta1"\nkind: "AuthorizationPolicy"\nmetadata:\n  name: "view-ratings"\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: ratings\n  rules:\n    - from:\n        - source:\n            principals: ["cluster.local/ns/default/sa/bookinfo-reviews"]\n      to:\n        - operation:\n            methods: ["GET", "POST"]\n')),s.createElement("h3",{className:"chapter-sub-heading"},"Allow per user access"),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},'---\napiVersion: "security.istio.io/v1beta1"\nkind: "AuthorizationPolicy"\nmetadata:\n  name: "view-reviews"\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: reviews\n  rules:\n    - from:\n        - source:\n            principals: ["cluster.local/ns/default/sa/bookinfo-productpage"]\n      to:\n        - operation:\n            methods: ["GET"]\n      when:\n        - key: request.headers[end-user]\n          values: ["naruto"]\n')),s.createElement("h3",{className:"chapter-sub-heading"},s.createElement(n.p,null,"Reset BookInfo Subsets (reset destination rules)")),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},"apiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: productpage\nspec:\n  host: productpage\n  subsets:\n    - name: v1\n      labels:\n        version: v1\n---\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: reviews\nspec:\n  host: reviews\n  subsets:\n    - name: v1\n      labels:\n        version: v1\n    - name: v2\n      labels:\n        version: v2\n    - name: v3\n      labels:\n        version: v3\n---\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: ratings\nspec:\n  host: ratings\n  subsets:\n    - name: v1\n      labels:\n        version: v1\n    - name: v2\n      labels:\n        version: v2\n    - name: v2-mysql\n      labels:\n        version: v2-mysql\n    - name: v2-mysql-vm\n      labels:\n        version: v2-mysql-vm\n---\napiVersion: networking.istio.io/v1alpha3\nkind: DestinationRule\nmetadata:\n  name: details\nspec:\n  host: details\n  subsets:\n    - name: v1\n      labels:\n        version: v1\n    - name: v2\n      labels:\n        version: v2\n---\n\n")),s.createElement("h2",{className:"chapter-sub-heading"},"Identity Verification"),s.createElement(n.p,null,"Note: this lab uses the sample application HTTPbin."),s.createElement(n.p,null,"Using Meshery, deploy the HTTPbin sample application."),s.createElement("h3",{className:"chapter-sub-heading"},"Add Claims"),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},'apiVersion: security.istio.io/v1beta1\nkind: AuthorizationPolicy\nmetadata:\n  name: require-jwt\n  namespace: foo\nspec:\n  selector:\n    matchLabels:\n      app: httpbin\n  action: ALLOW\n  rules:\n    - from:\n        - source:\n            requestPrincipals:\n              ["testing@secure.istio.io/testing@secure.istio.io"]\n      when:\n        - key: request.auth.claims[groups]\n          values: ["group1"]\n')),s.createElement("h3",{className:"chapter-sub-heading"},"Def"),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},'apiVersion: "security.istio.io/v1beta1"\nkind: "RequestAuthentication"\nmetadata:\n  name: "jwt"\n  namespace: default\nspec:\n  selector:\n    matchLabels:\n      app: httpbin\n  jwtRules:\n    - issuer: "testing@secure.istio.io"\n      jwksUri: "https://raw.githubusercontent.com/istio/istio/release-1.7/security/tools/jwt/samples/jwks.json"\n')),s.createElement("h2",{className:"chapter-sub-heading"},"Mutual TLS"),s.createElement(n.p,null,"Using Meshery, you can change mTLS enforcement for a namespace."),s.createElement(n.p,null,"To configure mTLS on more selective level, you can change and apply this configuration:"),s.createElement(n.pre,null,s.createElement(n.code,{className:"language-yaml"},'apiVersion: "security.istio.io/v1beta1"\nkind: "PeerAuthentication"\nmetadata:\n  name: "default"\n  namespace: "istio-system"\nspec:\n  # selector:\n  #   matchLabels:\n  #     app: httpbin\n  mtls:\n    mode: STRICT #ISTIO_MUTUAL,DISABLE\n  # portLevelMtls:\n  #   80:\n  #     mode: DISABLE\n')))}var r=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,t.R)(),e.components);return n?s.createElement(n,e,s.createElement(l,e)):l(e)},o=a(60522),c=a(79681),m=a(63562);const u=e=>{let{data:n,location:a,children:t}=e;const i=n.TOC.nodes.sort((e,n)=>{var a,t;return(null!==(a=e.frontmatter)&&void 0!==a&&a.order?e.frontmatter.order:100)-(null!==(t=n.frontmatter)&&void 0!==t&&t.order?n.frontmatter.order:100)});return s.createElement(s.Fragment,null,s.createElement(m.Ay,null,s.createElement(c.A,{chapterData:n.chapter,TOCData:i,courseData:n.course.nodes[0],location:a,serviceMeshesList:n.TOC.nodes},t)))};function p(e){return s.createElement(u,e,s.createElement(r,e))}const d=e=>{let{data:n}=e;return s.createElement(o.A,{title:n.chapter.frontmatter.chapterTitle,canonical:"https://layer5.io/learn/learning-paths"})}}}]);